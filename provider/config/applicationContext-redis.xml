<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:redis="http://www.springframework.org/schema/redis"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/redis
        http://www.springframework.org/schema/redis/spring-redis.xsd">
    <bean id="lettuceConnectionFactory"
          class="org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory" lazy-init="true">
        <constructor-arg>
            <bean class="org.springframework.data.redis.connection.RedisClusterConfiguration">
                <constructor-arg>

                    <bean class="org.springframework.core.env.MapPropertySource">
                        <constructor-arg>
                            <value>RedisClusterConfiguration</value>
                        </constructor-arg>
                        <constructor-arg>
                            <map>
                                <entry key="spring.redis.cluster.nodes"
                                       value="${spring.redis.cluster.nodes:127.0.0.1:7000,127.0.0.1:7001,127.0.0.1:7002,127.0.0.1:7003,127.0.0.1:7004,127.0.0.1:7005}"/>
                                <entry key="spring.redis.cluster.timeout" value="${spring.redis.cluster.timeout:6000}"/>
                                <entry key="spring.redis.cluster.max-redirects"
                                       value="${spring.redis.cluster.max-redirects:3}"/>
                            </map>
                        </constructor-arg>
                    </bean>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="org.springframework.data.redis.core.RedisTemplate"
          class="org.springframework.data.redis.core.RedisTemplate" lazy-init="true">
        <property name="connectionFactory" ref="lettuceConnectionFactory"/>
    </bean>

    <bean id="redisPubAction" class="top.cardone.cache.action.RedisPubAction" lazy-init="true">
        <property name="redisTemplate" ref="org.springframework.data.redis.core.RedisTemplate"/>
        <property name="channel" value="topic:cache"/>
    </bean>

    <bean id="redisTopicMessageListener" class="top.cardone.cache.listener.RedisTopicMessageListener">
        <property name="redisTemplate" ref="org.springframework.data.redis.core.RedisTemplate"/>
    </bean>

    <redis:listener-container connection-factory="lettuceConnectionFactory">
        <redis:listener ref="redisTopicMessageListener" topic="topic:cache"/>
    </redis:listener-container>
</beans>